<!DOCTYPE html>
<html>

<head>
    <title>Survey</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">
</head>

<body>
    <div class="container">

        <h2>Survey Questions</h2>
        <hr>
        <h3>About You</h3>
        <h4>Name (Required)</h4>
        <input type="text" class="form-control" placeholder="John Smith" id="name-input">
        <h4>Link to Photo Image (Required)</h4>
        <input type="text" class="form-control" id="photo-url-input">
        <hr>
        <h3>Question 1</h3>
        <h4>Your mind is always buzzing with unexplored ideas and plans.</h4>
        <div class="btn-group">
            <button class="btn btn-default btn-sm dropdown-toggle question" type="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false" id="q1">
                Select an Option
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li>
                    <a class="setScore">1 (Strongly Agree)</a>
                </li>
                <li>
                    <a href="#">2</a>
                </li>
                <li>
                    <a href="#">3</a>
                </li>
                <li>
                    <a href="#">4</a>
                </li>
                <li>
                    <a href="#">5 (Strongly Disagree)</a>
                </li>
            </ul>
        </div>

        <h3>Question 2</h3>
        <h4>Your mind is always buzzing with unexplored ideas and plans.</h4>
        <div class="btn-group">
            <button class="btn btn-default btn-sm dropdown-toggle question" type="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false" id="q2">
                Select an Option
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li>
                    <a href="#">1 (Strongly Agree)</a>
                </li>
                <li>
                    <a href="#">2</a>
                </li>
                <li>
                    <a href="#">3</a>
                </li>
                <li>
                    <a href="#">4</a>
                </li>
                <li>
                    <a href="#">5 (Strongly Disagree)</a>
                </li>
            </ul>
        </div>

        <h3>Question 3</h3>
        <h4>Your mind is always buzzing with unexplored ideas and plans.</h4>
        <div class="btn-group">
            <button class="btn btn-default btn-sm dropdown-toggle question" type="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false" id="q3">
                Select an Option
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li>
                    <a href="#">1 (Strongly Agree)</a>
                </li>
                <li>
                    <a href="#">2</a>
                </li>
                <li>
                    <a href="#">3</a>
                </li>
                <li>
                    <a href="#">4</a>
                </li>
                <li>
                    <a href="#">5 (Strongly Disagree)</a>
                </li>
            </ul>
        </div>

        <h3>Question 4</h3>
        <h4>Your mind is always buzzing with unexplored ideas and plans.</h4>
        <div class="btn-group">
            <button class="btn btn-default btn-sm dropdown-toggle question" type="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false" id="q4">
                Select an Option
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li>
                    <a href="#">1 (Strongly Agree)</a>
                </li>
                <li>
                    <a href="#">2</a>
                </li>
                <li>
                    <a href="#">3</a>
                </li>
                <li>
                    <a href="#">4</a>
                </li>
                <li>
                    <a href="#">5 (Strongly Disagree)</a>
                </li>
            </ul>
        </div>

        <h3>Question 5</h3>
        <h4>Your mind is always buzzing with unexplored ideas and plans.</h4>
        <div class="btn-group">
            <button class="btn btn-default btn-sm dropdown-toggle question" type="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false" id="q5">
                Select an Option
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li>
                    <a href="#">1 (Strongly Agree)</a>
                </li>
                <li>
                    <a href="#">2</a>
                </li>
                <li>
                    <a href="#">3</a>
                </li>
                <li>
                    <a href="#">4</a>
                </li>
                <li>
                    <a href="#">5 (Strongly Disagree)</a>
                </li>
            </ul>
        </div>

        <h3>Question 6</h3>
        <h4>Your mind is always buzzing with unexplored ideas and plans.</h4>
        <div class="btn-group">
            <button class="btn btn-default btn-sm dropdown-toggle question" type="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false" id="q6">
                Select an Option
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li>
                    <a href="#">1 (Strongly Agree)</a>
                </li>
                <li>
                    <a href="#">2</a>
                </li>
                <li>
                    <a href="#">3</a>
                </li>
                <li>
                    <a href="#">4</a>
                </li>
                <li>
                    <a href="#">5 (Strongly Disagree)</a>
                </li>
            </ul>
        </div>

        <h3>Question 7</h3>
        <h4>Your mind is always buzzing with unexplored ideas and plans.</h4>
        <div class="btn-group">
            <button class="btn btn-default btn-sm dropdown-toggle question" type="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false" id="q7">
                Select an Option
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li>
                    <a href="#">1 (Strongly Agree)</a>
                </li>
                <li>
                    <a href="#">2</a>
                </li>
                <li>
                    <a href="#">3</a>
                </li>
                <li>
                    <a href="#">4</a>
                </li>
                <li>
                    <a href="#">5 (Strongly Disagree)</a>
                </li>
            </ul>
        </div>

        <h3>Question 8</h3>
        <h4>Your mind is always buzzing with unexplored ideas and plans.</h4>
        <div class="btn-group">
            <button class="btn btn-default btn-sm dropdown-toggle question" type="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false" id="q8">
                Select an Option
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li>
                    <a href="#">1 (Strongly Agree)</a>
                </li>
                <li>
                    <a href="#">2</a>
                </li>
                <li>
                    <a href="#">3</a>
                </li>
                <li>
                    <a href="#">4</a>
                </li>
                <li>
                    <a href="#">5 (Strongly Disagree)</a>
                </li>
            </ul>
        </div>

        <h3>Question 9</h3>
        <h4>Your mind is always buzzing with unexplored ideas and plans.</h4>
        <div class="btn-group">
            <button class="btn btn-default btn-sm dropdown-toggle question" type="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false" id="q9">
                Select an Option
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li>
                    <a href="#">1 (Strongly Agree)</a>
                </li>
                <li>
                    <a href="#">2</a>
                </li>
                <li>
                    <a href="#">3</a>
                </li>
                <li>
                    <a href="#">4</a>
                </li>
                <li>
                    <a href="#">5 (Strongly Disagree)</a>
                </li>
            </ul>
        </div>

        <h3>Question 10</h3>
        <h4>Your mind is always buzzing with unexplored ideas and plans.</h4>
        <div class="btn-group">
            <button class="btn btn-default btn-sm dropdown-toggle question" type="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false" id="q10">
                Select an Option
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li>
                    <a href="#">1 (Strongly Agree)</a>
                </li>
                <li>
                    <a href="#">2</a>
                </li>
                <li>
                    <a href="#">3</a>
                </li>
                <li>
                    <a href="#">4</a>
                </li>
                <li>
                    <a href="#">5 (Strongly Disagree)</a>
                </li>
            </ul>
        </div>
        <br>
        <br>
        <button type="button" class="btn btn-lg btn-primary btn-block" data-target="#myModal" data-toggle="modal" id="submit">
            <span class="glyphicon glyphicon-list-alt">
            </span>
            Submit </button>

        <hr>
        <a href="#" id="consoleAPIFriends"> API Friends List </a>
        <br>
        <br>
    </div>

    <!-- Button trigger modal -->
    <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
        Launch demo modal
    </button>

    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h2 class="modal-title" id="myModalLabel">Best Matches</h2>
                </div>
                <div class="modal-body">
                    ...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" id="extra-button" data-dismiss="modal">Close</button>
                    <!-- <button type="button" class="btn btn-primary" id="modal-button">Save changes</button> -->
                    
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>
    <script type="text/javascript">
        $("#consoleAPIFriends").on("click", function (event) {
            $.ajax({ url: "/api/friends", method: "GET" })
                .then(function (friendsData) {
                    if (friendsData.length == 0) {
                        console.log("empty array")

                    }
                    else {
                        console.log("not empty")
                        console.log(friendsData);
                    }
                })
        })

        $("#submit").on("click", function (event) {
            event.preventDefault();
            var newFriend = {
                friendName: $("#name-input").val().trim(),
                photoURL: $("#photo-url-input").val().trim(),
                scoreArray: [parseInt($("#q1").text()), parseInt($("#q2").text()), parseInt($("#q3").text()), parseInt($("#q4").text()), parseInt($("#q5").text()), parseInt($("#q6").text()), parseInt($("#q7").text()), parseInt($("#q8").text()), parseInt($("#q9").text()), parseInt($("#q10").text())
                ]
            }


            // If requirements arent met:
            if (newFriend.friendName == "" || newFriend.photoURL == "" || newFriend.scoreArray.includes(NaN)) {
                console.log("all required fields are not met");
                $(".modal-body").text("all required fields are not met");
                // $("#extra-button").addClass("hidden");
                // $("#modal-button").text("Okay");
                $.ajax({ url: "/api/friends", method: "GET" })
                    .then(function (friendsData) {
                        console.log(friendsData.length)
                    });

            }
            // If requirements ARE met:
            else {
                $.ajax({ url: "/api/friends", method: "GET" })
                    .then(function (friendsData) {
                        console.log(friendsData.length)
                        if (friendsData.length == 0) {
                            console.log("empty array")
                            $(".modal-body").text("No other users currently in system to match with");

                        }
                        else {
                            var compatabilityScores = [];
                            var scoresOnly = [];
                            var minDif;
                            function compare(me, friend) {
                                var meArr = me['scoreArray'];
                                var friendArr = friend['scoreArray[]'];
                                var totalDif = 0;
                                for (var i = 0; i < 10; i++) {
                                    if (meArr[i] - parseInt(friendArr[i]) > 0) {
                                        totalDif += Math.abs(meArr[i] - friendArr[i]);
                                    }
                                }
                                var compatability = {
                                    friendName: friend['friendName'],
                                    photoURL: friend['photoURL'],
                                    score: totalDif
                                }
                                compatabilityScores.push(compatability);
                                scoresOnly.push(compatability.score);
                                console.log(friend['friendName'], totalDif);
                            }
                            console.log("not empty")
                            for (var i = 0; i < friendsData.length; i++) {
                                var friend = friendsData[i];
                                var friendScore = friend['scoreArray[]'];
                                compare(newFriend, friend);
                            }
                            console.log(compatabilityScores);
                            console.log(scoresOnly);
                            console.log(Math.min(...scoresOnly));
                            for (var i = 0; i < compatabilityScores.length; i++) {
                                friend = compatabilityScores[i]
                                var friendScore = friend['score'];
                                if (friendScore == Math.min(...scoresOnly)) {
                                    // console.log(compatabilityScores[i]);
                                    console.log("match", friend['friendName']);
                                    $(".modal-body").text("");
                                    $(".modal-body").append(friend['friendName']);
                                    $(".modal-body").append("<img src=" + friend['photoURL'] + " class='img-responsive'>");


                                }
                            }
                        }
                    })
                // console.log("requirements completed")
                // console.log(newFriend);
                $.post("/api/friends", newFriend, function (data) {
                    console.log(data)
                });
            }
        });

        $(".dropdown-menu li a").click(function () {
            var selText = $(this).text();
            $(this).parents(".btn-group").find(".dropdown-toggle").html(selText + " <span class='caret'></span>").addClass("completed");
        })
    </script>
</body>

</html>